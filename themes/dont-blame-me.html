<!DOCTYPE html><html lang="de"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Don't Blame Me üñ§</title>
    <script src="/assets_offline/1771357354199_dl_asset.css"></script>
    <link href="/assets_offline/1771357355568_dl_asset_famil.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #050505;
            color: #e5e5e5;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Neue, dramatische Fonts */
        .font-serif { font-family: 'Playfair Display', serif; }
        .font-cinzel { font-family: 'Cinzel', serif; }
        .font-old { font-family: 'Old Standard TT', serif; }

        /* Background Grain mit leichtem Rot-Stich */
        .bg-grain {
            position: fixed; inset: 0; pointer-events: none; z-index: -1; opacity: 0.06;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            background-color: rgba(50, 0, 0, 0.1); /* Leichter Rotschimmer */
        }

        /* Red Gradient Text */
        .text-gradient-crimson {
            background: linear-gradient(to right, #ff4d4d, #990000);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Glass Input Area */
        .glass-panel {
            background: rgba(20, 10, 10, 0.8); /* Leicht r√∂tlicher dunkler Hintergrund */
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 50, 50, 0.1); /* Roter Rand */
            box-shadow: 0 20px 50px -10px rgba(0,0,0,0.8);
        }

        .input-area:focus {
            outline: none;
            background: rgba(255, 50, 50, 0.03);
        }

        /* --- ART CARD STYLES --- */
        .card-container {
            display: flex; flex-direction: column;
            border-radius: 24px; overflow: hidden;
            background: #0a0a0a; border: 1px solid #1a1a1a;
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
        }
        .card-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(50,0,0,0.3); /* Roter Schatten */
            border-color: #7f1d1d; /* Dunkelroter Rand */
        }

        .art-header {
            width: 100%; aspect-ratio: 16/9;
            display: flex; align-items: center; justify-content: center;
            padding: 2rem; text-align: center; position: relative; overflow: hidden;
        }
        
        .art-text {
            line-height: 1.1; word-wrap: break-word; position: relative; z-index: 2;
            text-shadow: 0 4px 15px rgba(0,0,0,0.5);
            transform: rotate(-2deg);
        }

        .art-overlay {
            position: absolute; inset: 0; 
            background: linear-gradient(to bottom, transparent, rgba(0,0,0,0.6));
            pointer-events: none; z-index: 1;
        }

        .card-body {
            padding: 1.5rem; display: flex; flex-direction: column; gap: 1rem; height: 100%;
            background: linear-gradient(to bottom, #0a0a0a, #110a0a);
        }

        /* Neuer Roter Button */
        .btn-submit-crimson {
            background: linear-gradient(135deg, #dc2626, #991b1b);
            color: white; border: none; text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            transition: all 0.2s; font-weight: 800;
        }
        .btn-submit-crimson:hover { 
            transform: scale(1.05); 
            background: linear-gradient(135deg, #ef4444, #b91c1c);
            box-shadow: 0 0 25px rgba(220, 38, 38, 0.4); 
        }
        .btn-submit-crimson:disabled { filter: grayscale(0.8); opacity: 0.7; cursor: not-allowed; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="bg-grain"></div>

    <div class="w-full max-w-[1800px] mx-auto">
        
        <header class="text-center mb-12 mt-4">
            <a href="/" class="text-xs text-red-500/70 hover:text-red-400 tracking-widest mb-6 inline-block uppercase font-bold transition-colors">‚Üê Zur√ºck zum Portal</a>
            <h1 class="text-6xl md:text-8xl font-serif font-black italic mb-4 tracking-tight text-gradient-crimson drop-shadow-2xl">
                Don't Blame Me
            </h1>
            <p class="text-gray-400 font-light text-lg md:text-xl tracking-wide max-w-2xl mx-auto">
                Schieb die Schuld auf den Code, das Wetter oder den Lag. <br>Hier glaubt dir jeder.
            </p>
        </header>

        <div id="user-area" class="max-w-2xl mx-auto mb-24 hidden fade-in">
            <form id="post-form" class="glass-panel p-2 rounded-3xl relative group transition-all focus-within:ring-2 ring-red-900/50">
                <textarea id="reason-input" rows="3" maxlength="140" placeholder="Ich war's nicht, weil..." class="input-area w-full bg-transparent text-white p-6 rounded-2xl border border-transparent resize-none text-2xl placeholder-gray-700 focus:placeholder-red-400/50 leading-normal"></textarea>
                
                <div class="flex justify-between items-center px-6 pb-4 pt-2">
                    <span id="char-count" class="text-xs text-gray-500 font-mono">0/140</span>
                    <button id="submit-btn" type="submit" class="btn-submit-crimson px-8 py-3 rounded-full text-sm uppercase tracking-widest">
                        Ver√∂ffentlichen
                    </button>
                </div>
            </form>
            <div id="error-message" class="text-red-400 text-center mt-4 text-sm font-mono bg-red-950/50 border border-red-900/50 py-2 rounded hidden"></div>
        </div>

        <div id="guest-area" class="text-center mb-20">
            <div class="glass-panel inline-block px-10 py-6 rounded-full border border-red-900/30">
                <p class="text-gray-300 text-lg">üîí <a href="#" onclick="openLogin()" class="text-red-500 font-bold underline decoration-2 underline-offset-4 hover:text-red-400 transition-colors">Logge dich ein</a>, um deine Unschuld zu beweisen.</p>
            </div>
        </div>

        <div id="posts-container" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-8">
            <div class="text-center col-span-full text-gray-600 py-20 text-xl">Lade die Akten...</div>
        </div>

    </div>

    <script>
        const API_URL = 'https://api.limazon.v6.rocks'; 
        
        // --- RENDER LOGIC ---

        function renderCard(post) {
            const container = document.createElement('div');
            container.className = 'card-container group';

            // 1. ARTWORK (Oben)
            const artDiv = document.createElement('div');
            artDiv.className = 'art-header';
            
            const p = post.imageParams || {};
            // Fallback zu einem dunklen Rot-Ton, falls die DB nichts liefert, sonst die DB-Farbe
            artDiv.style.backgroundColor = p.backgroundColor || '#2a0a0a';
            
            const title = document.createElement('h2');
            title.className = 'art-text';
            title.innerText = "Don't Blame Me";
            // Fallback zu Wei√ü oder einem hellen Rot
            title.style.color = p.textColor || '#ffcccc';
            // Mehr Font-Auswahl
            const fonts = ['Playfair Display', 'Cinzel', 'Old Standard TT', 'serif'];
            title.style.fontFamily = p.fontFamily && fonts.includes(p.fontFamily) ? p.fontFamily : fonts[Math.floor(Math.random() * fonts.length)];
            
            title.style.fontSize = (parseInt(p.fontSize || 24) * 1.6) + 'px'; 
            title.style.fontWeight = '900';
            
            const overlay = document.createElement('div');
            overlay.className = 'art-overlay';

            artDiv.appendChild(overlay);
            artDiv.appendChild(title);

            // 2. CONTENT (Unten)
            const bodyDiv = document.createElement('div');
            bodyDiv.className = 'card-body';

            const avatarUrl = `https://ui-avatars.com/api/?name=${post.username}&background=111&color=900&size=48&bold=true`;
            
            bodyDiv.innerHTML = `
                <div class="flex-grow">
                    <p class="text-2xl text-gray-200 font-serif leading-tight italic">"${post.reason}"</p>
                </div>
                <div class="flex items-center gap-3 pt-4 border-t border-red-900/30 mt-2">
                    <img src="${avatarUrl}" class="w-8 h-8 rounded-full opacity-80 border border-red-900/50">
                    <span class="text-xs font-mono text-red-400/70 uppercase tracking-wider">${post.username}</span>
                </div>
            `;

            container.appendChild(artDiv);
            container.appendChild(bodyDiv);
            return container;
        }

        async function fetchPosts() {
            try {
                const response = await fetch(`${API_URL}/api/dont-blame-me`);
                const data = await response.json();
                const container = document.getElementById('posts-container');

                container.innerHTML = ''; 
                
                if(!data.posts || data.posts.length === 0) {
                    container.innerHTML = '<div class="text-center text-gray-500 text-xl w-full col-span-full mt-10">Noch keine Eintr√§ge. Sei der Erste!</div>';
                    return;
                }

                data.posts.forEach(post => {
                    const card = renderCard(post);
                    container.appendChild(card);
                });
            } catch (error) {
                console.error(error);
                document.getElementById('posts-container').innerHTML = '<div class="text-red-500 text-center col-span-full py-10">Fehler beim Laden der Datenbank.</div>';
            }
        }

        // --- FORM HANDLING ---
        const postForm = document.getElementById('post-form');
        const reasonInput = document.getElementById('reason-input');
        const charCount = document.getElementById('char-count');
        const errorBox = document.getElementById('error-message');

        if(reasonInput) {
            reasonInput.addEventListener('input', () => {
                const len = reasonInput.value.length;
                charCount.innerText = `${len}/140`;
                if(len > 120) charCount.classList.add('text-red-500');
                else charCount.classList.remove('text-red-500');
            });
        }

        if (postForm) {
            postForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const reason = reasonInput.value.trim();
                const btn = document.getElementById('submit-btn');

                errorBox.classList.add('hidden');
                
                if (!reason) return;

                btn.disabled = true;
                btn.innerText = "SENDE...";

                try {
                    const response = await fetch(`${API_URL}/api/dont-blame-me`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ reason }),
                        credentials: 'include'
                    });

                    if (response.ok) {
                        reasonInput.value = '';
                        charCount.innerText = '0/140';
                        fetchPosts();
                    } else {
                        const d = await response.json();
                        errorBox.innerText = d.error || "Fehler beim Senden.";
                        errorBox.classList.remove('hidden');
                    }
                } catch (error) {
                    errorBox.innerText = "Verbindungsfehler.";
                    errorBox.classList.remove('hidden');
                } finally {
                    btn.disabled = false;
                    btn.innerText = "VER√ñFFENTLICHEN";
                }
            });
        }
        
        async function checkLoginStatus() {
            try {
                const res = await fetch(`${API_URL}/api/auth/me`, { credentials: 'include' });
                if(res.ok) {
                    document.getElementById('user-area').classList.remove('hidden');
                    document.getElementById('guest-area').classList.add('hidden');
                } else {
                    document.getElementById('user-area').classList.add('hidden');
                    document.getElementById('guest-area').classList.remove('hidden');
                }
            } catch(e) {}
        }

        function openLogin() {
            alert("Bitte logge dich √ºber das Hauptportal ein.");
            window.location.href = '../index.html'; 
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            fetchPosts();
            checkLoginStatus();
        });

    </script>

</body></html>