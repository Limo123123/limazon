<!DOCTYPE html><html lang="de"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Limo's Diner</title>
    <script src="/assets_offline/1771357354199_dl_asset.css"></script>
    <link href="/assets_offline/1771357361431_dl_asset_famil.css" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f0f12;
            --panel-bg: rgba(30, 30, 35, 0.6);
            --border: rgba(255, 255, 255, 0.08);
            --brand: #db2777;
            /* Pink */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: #e4e4e7;
            background-image:
                radial-gradient(circle at 0% 0%, rgba(219, 39, 119, 0.1), transparent 40%),
                radial-gradient(circle at 100% 0%, rgba(234, 179, 8, 0.05), transparent 40%);
            background-attachment: fixed;
        }

        .font-brand {
            font-family: 'Rajdhani', sans-serif;
        }

        .glass-panel {
            background: var(--panel-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border);
        }

        /* Card Hover Effects */
        .menu-card {
            transition: all 0.2s ease-in-out;
        }

        .menu-card:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--brand);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Hide Number Arrows */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .active-tab {
            background-color: var(--brand);
            color: white;
            border-color: var(--brand);
        }

        .inactive-tab {
            background-color: rgba(255, 255, 255, 0.05);
            color: #9ca3af;
            border-color: rgba(255, 255, 255, 0.1);
        }
    </style>
</head>

<body class="min-h-screen flex flex-col pb-24 lg:pb-0">

    <nav class="sticky top-0 z-50 glass-panel border-b border-white/10 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center gap-4">
                    <button onclick="window.location.href='/'" class="w-10 h-10 rounded-lg bg-white/5 hover:bg-white/10 flex items-center justify-center transition text-gray-400 hover:text-white">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                    </button>
                    <h1 class="text-2xl font-brand font-bold uppercase tracking-widest text-white italic">
                        Limo's <span class="text-pink-500">Diner</span>
                    </h1>
                </div>

                <div class="hidden lg:flex space-x-4">
                    <button onclick="switchView('menu')" id="nav-menu" class="px-4 py-2 rounded-lg text-sm font-bold transition bg-pink-600 text-white shadow-lg shadow-pink-900/50">SPEISEKARTE</button>
                    <button onclick="switchView('history')" id="nav-history" class="px-4 py-2 rounded-lg text-sm font-bold transition bg-white/5 text-gray-400 hover:text-white">BESTELLUNGEN</button>
                </div>

                <div class="lg:hidden text-right">
                    <div class="text-[10px] text-gray-500 uppercase font-bold">Budget</div>
                    <div class="font-mono font-bold text-green-400" id="mobile-balance">$ ---</div>
                </div>
            </div>
        </div>
    </nav>

    <main class="flex-grow max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-6">

        <div class="flex lg:hidden mb-6 bg-white/5 p-1 rounded-xl">
            <button onclick="switchView('menu')" id="mob-nav-menu" class="flex-1 py-2 rounded-lg text-sm font-bold text-center bg-pink-600 text-white shadow">Karte</button>
            <button onclick="switchView('history')" id="mob-nav-history" class="flex-1 py-2 rounded-lg text-sm font-bold text-center text-gray-400">Verlauf</button>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">

            <div class="lg:col-span-8 space-y-6" id="view-menu">

                <div class="flex gap-2 overflow-x-auto pb-2 no-scrollbar">
                    <button onclick="filterMenu('all', this)" class="cat-btn active-tab border px-4 py-2 rounded-lg text-xs font-bold uppercase whitespace-nowrap transition">Alle</button>
                    <button onclick="filterMenu('burger', this)" class="cat-btn inactive-tab border px-4 py-2 rounded-lg text-xs font-bold uppercase whitespace-nowrap transition hover:text-white">üçî
                        Burger</button>
                    <button onclick="filterMenu('pizza', this)" class="cat-btn inactive-tab border px-4 py-2 rounded-lg text-xs font-bold uppercase whitespace-nowrap transition hover:text-white">üçï
                        Pizza</button>
                    <button onclick="filterMenu('side', this)" class="cat-btn inactive-tab border px-4 py-2 rounded-lg text-xs font-bold uppercase whitespace-nowrap transition hover:text-white">üçü
                        Sides</button>
                    <button onclick="filterMenu('drink', this)" class="cat-btn inactive-tab border px-4 py-2 rounded-lg text-xs font-bold uppercase whitespace-nowrap transition hover:text-white">ü•§
                        Drinks</button>
                    <button onclick="filterMenu('luxury', this)" class="cat-btn inactive-tab border px-4 py-2 rounded-lg text-xs font-bold uppercase whitespace-nowrap transition text-yellow-500 border-yellow-500/20 hover:bg-yellow-500/10">üíé
                        Luxus</button>
                </div>

                <div id="menu-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="col-span-full py-20 text-center text-gray-500 animate-pulse">Lade K√ºche...</div>
                </div>
            </div>

            <div class="lg:col-span-8 hidden" id="view-history">
                <h2 class="text-xl font-brand font-bold text-white mb-4 border-b border-white/10 pb-2">Deine letzten
                    Mahlzeiten</h2>
                <div id="history-list" class="space-y-4">
                </div>
            </div>

            <div class="hidden lg:block lg:col-span-4 lg:sticky lg:top-24 space-y-6">

                <div class="glass-panel rounded-2xl p-6 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-24 h-24 bg-pink-500/10 rounded-full blur-2xl -mr-10 -mt-10 pointer-events-none">
                    </div>

                    <div class="flex justify-between items-center mb-4">
                        <span class="text-xs text-gray-400 uppercase font-bold tracking-wider">Dein Guthaben</span>
                        <span class="font-mono font-bold text-green-400 text-lg" id="desktop-balance">$ ---</span>
                    </div>

                    <div class="space-y-2">
                        <div class="flex justify-between text-xs text-gray-300">
                            <span>Energie</span>
                            <span id="energy-text" class="font-bold">0%</span>
                        </div>
                        <div class="w-full bg-gray-800 rounded-full h-2 overflow-hidden">
                            <div id="energy-bar" class="bg-gradient-to-r from-yellow-600 to-yellow-400 h-full rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                        <p class="text-[10px] text-gray-500 pt-1">Iss etwas, um Energie f√ºr deinen Job zu tanken.</p>
                    </div>
                </div>

                <div class="glass-panel rounded-2xl p-6 border-t-4 border-t-pink-500">
                    <h3 class="font-brand font-bold text-lg text-white mb-4 flex items-center gap-2">
                        <span>üõí</span> Warenkorb
                    </h3>

                    <div id="desktop-cart-list" class="space-y-3 mb-6 max-h-[300px] overflow-y-auto pr-1">
                        <div class="text-sm text-gray-500 text-center py-4">W√§hle Gerichte aus.</div>
                    </div>

                    <div class="border-t border-white/10 pt-4 space-y-4">
                        <div class="flex justify-between items-end">
                            <span class="text-sm text-gray-400">Summe</span>
                            <span class="text-2xl font-mono font-bold text-white" id="desktop-cart-total">$ 0.00</span>
                        </div>
                        <button onclick="placeOrder()" id="desktop-order-btn" class="w-full py-3 bg-pink-600 hover:bg-pink-500 text-white font-bold rounded-xl transition shadow-lg shadow-pink-900/30 disabled:opacity-50 disabled:cursor-not-allowed">
                            KOSTENPFLICHTIG BESTELLEN
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <div id="mobile-cart" class="fixed bottom-0 left-0 right-0 glass-panel border-t border-pink-500/30 p-4 lg:hidden z-40 transform translate-y-full transition-transform duration-300">
        <div class="flex justify-between items-center max-w-7xl mx-auto">
            <div class="flex flex-col">
                <span class="text-[10px] text-gray-400 uppercase font-bold">Summe</span>
                <span class="text-xl font-mono font-bold text-white" id="mobile-cart-total">$ 0.00</span>
            </div>
            <button onclick="placeOrder()" id="mobile-order-btn" class="bg-pink-600 hover:bg-pink-500 text-white font-bold py-2 px-6 rounded-lg shadow-lg">
                BESTELLEN (<span id="mobile-cart-count">0</span>)
            </button>
        </div>
    </div>

    <script>
        const API_URL = 'https://api.limazon.v6.rocks';
        let menuData = [];
        let cart = {}; // { itemId: quantity }

        document.addEventListener('DOMContentLoaded', () => {
            loadMenu();
            loadStatus();
        });

        // --- DATA ---
        async function loadMenu() {
            try {
                const res = await fetch(`${API_URL}/api/restaurant/menu`, { credentials: 'include' });
                if (res.ok) {
                    const data = await res.json();
                    menuData = data.menu;
                    renderMenu('all');
                }
            } catch (e) { console.error(e); }
        }

        async function loadStatus() {
            try {
                // 1. User Daten laden (Guthaben)
                const resUser = await fetch(`${API_URL}/api/auth/me`, { credentials: 'include' });
                
                if (resUser.ok) {
                    const u = await resUser.json();
                    
                    // KORREKTUR: min 2, max 2 (damit es immer z.B. "10,50" ist)
                    const moneyText = '$ ' + u.balance.toLocaleString('de-DE', {
                        minimumFractionDigits: 2, 
                        maximumFractionDigits: 2 
                    });
                    
                    // Alle m√∂glichen IDs updaten
                    const idsToUpdate = ['mobile-balance', 'desktop-balance', 'user-balance'];
                    
                    idsToUpdate.forEach(id => {
                        const el = document.getElementById(id);
                        if (el) {
                            el.innerText = moneyText;
                            el.classList.remove('text-red-500'); 
                            el.classList.add('text-green-400');
                        }
                    });
                } else {
                    // Nicht eingeloggt
                    ['mobile-balance', 'desktop-balance'].forEach(id => {
                        const el = document.getElementById(id);
                        if (el) {
                            el.innerText = "Login?";
                            el.className = "font-mono font-bold text-red-500 text-xs";
                        }
                    });
                }

                // 2. Energie Status laden
                const resStat = await fetch(`${API_URL}/api/restaurant/status`, { credentials: 'include' });
                if (resStat.ok) {
                    const d = await resStat.json();
                    const enEl = document.getElementById('energy-text');
                    const barEl = document.getElementById('energy-bar');
                    const bubbleEl = document.getElementById('user-energy');

                    if (enEl) enEl.innerText = d.energy + '%';
                    if (barEl) barEl.style.width = d.energy + '%';
                    
                    if (bubbleEl) {
                        bubbleEl.innerText = d.energy + '%';
                        if (d.energy < 30) {
                            bubbleEl.className = "w-10 h-10 rounded-full bg-red-900/20 flex items-center justify-center font-mono font-bold text-xs text-red-400 border border-red-500/50";
                        } else {
                            bubbleEl.className = "w-10 h-10 rounded-full bg-green-900/20 flex items-center justify-center font-mono font-bold text-xs text-green-400 border border-green-500/50";
                        }
                    }
                }

            } catch (e) {
                console.error("Status Error:", e);
            }
        }
        
        async function loadHistory() {
            const list = document.getElementById('history-list');
            list.innerHTML = '<div class="py-10 text-center text-gray-500">Lade...</div>';
            try {
                const res = await fetch(`${API_URL}/api/restaurant/history`, { credentials: 'include' });
                if (res.ok) {
                    const data = await res.json();
                    if (data.history.length === 0) { list.innerHTML = '<div class="py-10 text-center text-gray-500">Keine Eintr√§ge.</div>'; return; }

                    list.innerHTML = data.history.map(h => {
                        const date = new Date(h.date).toLocaleString('de-DE', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                        return `
                        <div class="glass-panel p-4 rounded-xl flex justify-between items-center">
                            <div>
                                <div class="text-xs text-gray-500 mb-1">${date}</div>
                                <div class="text-sm font-bold text-white">${h.items.map(i => i.name).join(', ')}</div>
                            </div>
                            <div class="text-right">
                                <div class="font-mono text-red-400 font-bold">-$${h.cost.toFixed(2)}</div>
                                <div class="text-[10px] text-yellow-500 font-bold">+${h.energyGained}% Energy</div>
                            </div>
                        </div>`;
                    }).join('');
                }
            } catch (e) { list.innerHTML = '<div class="text-red-500">Fehler.</div>'; }
        }

        // --- UI ---
        function switchView(view) {
            // Update Desktop Nav
            document.getElementById('nav-menu').className = view === 'menu' ? "px-4 py-2 rounded-lg text-sm font-bold transition bg-pink-600 text-white shadow-lg" : "px-4 py-2 rounded-lg text-sm font-bold transition bg-white/5 text-gray-400 hover:text-white";
            document.getElementById('nav-history').className = view === 'history' ? "px-4 py-2 rounded-lg text-sm font-bold transition bg-pink-600 text-white shadow-lg" : "px-4 py-2 rounded-lg text-sm font-bold transition bg-white/5 text-gray-400 hover:text-white";

            // Update Mobile Nav
            document.getElementById('mob-nav-menu').className = view === 'menu' ? "flex-1 py-2 rounded-lg text-sm font-bold text-center bg-pink-600 text-white shadow" : "flex-1 py-2 rounded-lg text-sm font-bold text-center text-gray-400";
            document.getElementById('mob-nav-history').className = view === 'history' ? "flex-1 py-2 rounded-lg text-sm font-bold text-center bg-pink-600 text-white shadow" : "flex-1 py-2 rounded-lg text-sm font-bold text-center text-gray-400";

            // Content
            if (view === 'menu') {
                document.getElementById('view-menu').classList.remove('hidden');
                document.getElementById('view-history').classList.add('hidden');
            } else {
                document.getElementById('view-menu').classList.add('hidden');
                document.getElementById('view-history').classList.remove('hidden');
                loadHistory();
            }
        }

        function filterMenu(type, btn) {
            document.querySelectorAll('.cat-btn').forEach(b => b.className = "cat-btn inactive-tab border px-4 py-2 rounded-lg text-xs font-bold uppercase whitespace-nowrap transition hover:text-white border-white/10");
            btn.className = "cat-btn active-tab border px-4 py-2 rounded-lg text-xs font-bold uppercase whitespace-nowrap transition shadow-lg shadow-pink-900/30";
            renderMenu(type);
        }

        function renderMenu(type) {
            const grid = document.getElementById('menu-grid');
            const items = type === 'all' ? menuData : menuData.filter(i => i.type === type);

            grid.innerHTML = items.map(item => {
                const qty = cart[item.id] || 0;
                const activeClass = qty > 0 ? 'border-pink-500 bg-pink-500/5' : 'border-white/5 bg-white/5';

                return `
                <div class="menu-card rounded-xl p-4 border ${activeClass} flex gap-4">
                    <div class="text-4xl w-16 h-16 rounded-lg bg-black/40 flex items-center justify-center shadow-inner border border-white/5">
                        ${item.icon}
                    </div>
                    <div class="flex-grow flex flex-col justify-between">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="font-bold text-white text-lg leading-tight">${item.name}</h3>
                                <p class="text-[10px] text-gray-500">${item.desc}</p>
                            </div>
                            <div class="text-right">
                                <div class="font-mono font-bold text-pink-400">$${item.price.toFixed(0)}</div>
                                <div class="text-[10px] text-yellow-600 font-bold">‚ö° ${item.energy}%</div>
                            </div>
                        </div>
                        
                        <div class="flex justify-end mt-2">
                            <div class="flex items-center bg-black/50 rounded-lg border border-white/10">
                                <button onclick="changeQty('${item.id}', -1)" class="w-8 h-8 flex items-center justify-center text-gray-400 hover:text-white hover:bg-white/10 rounded-l-lg transition font-bold">-</button>
                                <span class="w-8 text-center font-mono text-sm font-bold text-white" id="qty-${item.id}">${qty}</span>
                                <button onclick="changeQty('${item.id}', 1)" class="w-8 h-8 flex items-center justify-center text-gray-400 hover:text-white hover:bg-white/10 rounded-r-lg transition font-bold">+</button>
                            </div>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        // --- CART LOGIC ---
        function changeQty(id, delta) {
            if (!cart[id]) cart[id] = 0;
            cart[id] += delta;
            if (cart[id] <= 0) delete cart[id];

            const el = document.getElementById(`qty-${id}`);
            if (el) {
                el.innerText = cart[id] || 0;
                const card = el.closest('.menu-card');
                if (cart[id]) {
                    card.classList.remove('border-white/5', 'bg-white/5');
                    card.classList.add('border-pink-500', 'bg-pink-500/5');
                } else {
                    card.classList.add('border-white/5', 'bg-white/5');
                    card.classList.remove('border-pink-500', 'bg-pink-500/5');
                }
            }
            updateCartUI();
        }

        function updateCartUI() {
            let total = 0;
            let count = 0;
            let itemsHtml = "";

            for (const [id, qty] of Object.entries(cart)) {
                const item = menuData.find(i => i.id === id);
                if (item) {
                    total += item.price * qty;
                    count += qty;
                    itemsHtml += `
                    <div class="flex justify-between items-center text-sm py-1 border-b border-white/5 last:border-0">
                        <div class="text-gray-300">${qty}x ${item.name}</div>
                        <div class="font-mono text-white">$${(item.price * qty).toFixed(2)}</div>
                    </div>`;
                }
            }

            // Desktop Sidebar
            const dList = document.getElementById('desktop-cart-list');
            if (dList) dList.innerHTML = count > 0 ? itemsHtml : '<div class="text-sm text-gray-500 text-center py-4">W√§hle Gerichte aus.</div>';
            const dTotal = document.getElementById('desktop-cart-total');
            if (dTotal) dTotal.innerText = '$ ' + total.toLocaleString('de-DE', { minimumFractionDigits: 2 });
            const dBtn = document.getElementById('desktop-order-btn');
            if (dBtn) dBtn.disabled = count === 0;

            // Mobile Bar
            const mBar = document.getElementById('mobile-cart');
            const mTotal = document.getElementById('mobile-cart-total');
            const mCount = document.getElementById('mobile-cart-count');

            if (mTotal) mTotal.innerText = '$ ' + total.toLocaleString('de-DE', { minimumFractionDigits: 2 });
            if (mCount) mCount.innerText = count;

            if (mBar) {
                if (count > 0) mBar.classList.remove('translate-y-full');
                else mBar.classList.add('translate-y-full');
            }
        }

        async function placeOrder() {
            let itemIds = [];
            for (const [id, qty] of Object.entries(cart)) {
                for (let i = 0; i < qty; i++) itemIds.push(id);
            }

            const btns = [document.getElementById('desktop-order-btn'), document.getElementById('mobile-order-btn')];
            btns.forEach(b => { if (b) { b.disabled = true; b.innerText = "Sende..."; } });

            try {
                const res = await fetch(`${API_URL}/api/restaurant/order`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ itemIds }), credentials: 'include'
                });
                const d = await res.json();

                if (res.ok) {
                    alert(d.message);
                    cart = {};
                    renderMenu(document.querySelector('.cat-btn.active-tab').innerText === 'Alle' ? 'all' : 'burger');
                    updateCartUI();
                    loadStatus();
                } else { alert(d.error); }
            } catch (e) { alert("Verbindungsfehler"); }

            btns.forEach(b => {
                if (b) {
                    b.disabled = false;
                    if (b.id === 'mobile-order-btn') b.innerHTML = 'BESTELLEN (<span id="mobile-cart-count">0</span>)';
                    else b.innerText = "KOSTENPFLICHTIG BESTELLEN";
                }
            });
            updateCartUI();
        }
    </script>


</body></html>